$(document).ready(function(){getParams(),currentScreen(),$("#vacuchekRegister").fadeIn(),$("#btn-check").click(async e=>{e.preventDefault(),await check()}),$("#btn-check2").click(async e=>{e.preventDefault(),await checkAnswers()}),$("#btn-create").click(async e=>{e.preventDefault(),await create()}),$("#phone").keydown(function(){$("#phone").val().startsWith("6")?$("#phone").mask("0000-0000",{placeholder:"####-####",selectOnFocus:!0}):$("#phone").mask("000-0000",{placeholder:"###-####",selectOnFocus:!0})});var e=new Image;e.src="http://vacunas.panamasolidario.gob.pa/vacucheck/img/bg.jpg";var a=setInterval(function(){e.complete&&(clearInterval(a),document.getElementsByTagName("body")[0].style.backgroundImage="url("+e.src+")")},50)});const currentScreen=async()=>{let e=JSON.parse(await getCurrentScreen()).CURRENT_SCREEN;1==e?showScreen(1):2==e?showScreen(2):3==e&&(await loadData(),showScreen(3))},check=async()=>{if($("#countyAnswers").empty(),$("#rucAnswers").empty(),$("#startOperationsAnswers").empty(),$("#namesAnswer").empty(),$("#dvAnswer").empty(),$("#operation-number").removeClass("animate__animated animate__shakeX placeholder-red-200 border-red-300"),!$("#operation-number").val())return $("#operation-number").addClass("border-red-300"),Swal.fire({html:"<div style='text-align:left'>Ingrese el número de aviso de operación de la empresa.</div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}),void $("#operation-number").addClass("animate__animated animate__shakeX placeholder-red-200 border-red-300");$("#btn-check").addClass("opacity-50 cursor-not-allowed"),$("#loader").removeClass("hidden"),$("#lbl-next1").addClass("hidden"),await grecaptcha.ready(async()=>{grecaptcha.execute("6LeiVcYaAAAAAJdD1cpDx2jP8PSGokBgnG9hKDob",{action:"check"}).then(function(e){$("#_token").val(e);let a=$("#operation-number").val(),r=$("#uuid").val(),n=$("#_token").val();$.ajax({url:"./check.php",method:"POST",data:{operationNumber:a,_token:n,action:"check",uuid:r},success:function(e){getParams();try{let a=JSON.parse(e);switch(a[0]){case"EXISTS":return Swal.fire({html:"El número de aviso de operación ingresado ya se encuentra registrado.",icon:"info",position:"top"}),void setTimeout(function(){window.location.reload()},12e3);case"ERROR_CAPTCHA":return void Swal.fire({html:"<div style='text-align:left'>Se ha presentado un inconveniente con el <b>captcha</b>, por favor intente nuevamente.</div>",icon:"error",confirmButtonText:"Aceptar",position:"top"});case"ERROR":return void Swal.fire({html:`<div style='text-align:left'>${a.message}</div>`,icon:"error",confirmButtonText:"Aceptar",position:"top"});case"ENABLE_ANSWERS":enableAnswers(a.answers)}}catch(e){finishLoad()}},complete:()=>{finishLoad()},error:()=>{finishLoad()}})})})},checkAnswers=async()=>{$("#btn-check2").addClass("opacity-50 cursor-not-allowed"),$("#loader2").removeClass("hidden"),$("#lbl-next2").addClass("hidden"),$("#check-mark").removeClass("animate__animated animate__fadeOutUp").addClass("hidden"),await grecaptcha.ready(async()=>{grecaptcha.execute("6LeiVcYaAAAAAJdD1cpDx2jP8PSGokBgnG9hKDob",{action:"checkAnswers"}).then(function(e){$("#_token").val(e);let a=$("#_token").val(),r=$("#countyAnswers").val(),n=$("#rucAnswers").val(),t=$("#startOperationsAnswers").val(),o=$("#namesAnswer").val(),s=$("#dvAnswer").val(),i=$("#uuid").val();$.ajax({url:"./checkAnswers.php",method:"POST",data:{_token:a,action:"checkAnswers",countyAnswers:r,rucAnswers:n,startOperationsAnswers:t,namesAnswer:o,dvAnswer:s,uuid:i},success:function(e){getParams(),loadData(),enableRegisterForm(e)},complete:()=>{finishCheckAnswers()},error:()=>{finishCheckAnswers()}})})})},enableAnswers=e=>{$("#progress-loader").addClass("animate__animated animate__fadeIn").removeClass("hidden"),$("#verfy-operation-number").addClass("hidden").css("display","none"),$("#verfy-answers").removeClass("hidden").addClass("animate__animated animate__fadeIn"),enableCounty(e.counties),enableRUC(e.ruc),enableStartOperation(e.startOperations),enableNames(e.names),enableDV(e.dv)},enableCounty=e=>{void 0!==e?($("#countyAnswers").append(new Option("","")),e.forEach(e=>{$("#countyAnswers").append(new Option(e,e))}),$("#countyContainer").fadeIn()):($("#countyContainer").fadeOut(),$("#countyAnswers").empty())},enableRUC=e=>{void 0!==e?($("#rucAnswers").append(new Option("","")),e.forEach(e=>{$("#rucAnswers").append(new Option(e,e))}),$("#rucContainer").fadeIn()):($("#rucContainer").fadeOut(),$("#rucAnswers").empty())},enableStartOperation=e=>{void 0!==e?($("#startOperationsAnswers").append(new Option("","")),e.forEach(e=>{$("#startOperationsAnswers").append(new Option(e,e))}),$("#startOperationsContainer").fadeIn()):($("#startOperationsContainer").fadeOut(),$("#startOperationsAnswers").empty())},enableNames=e=>{void 0!==e?($("#namesAnswer").append(new Option("","")),e.forEach(e=>{$("#namesAnswer").append(new Option(e,e))}),$("#nameContainer").fadeIn()):($("#nameContainer").fadeOut(),$("#namesAnswer").empty())},enableDV=e=>{void 0!==e?($("#dvAnswer").append(new Option("","")),e.forEach(e=>{$("#dvAnswer").append(new Option(e,e))}),$("#dvContainer").fadeIn()):$("#dvContainer").fadeOut()},enableRegisterForm=e=>{let a=JSON.parse(e);if("MAX_NUMBER_OF_ERRORS"==a[0]){let e,r=a[1];if(1==r)e="Ha superado el límite de intentos fallidos, tiene que esperar <b>1 hora</b> para volverlo a intentar.";else if(r>1){e=`Ha superado el límite de intentos fallidos, tiene que esperar <b>${Math.round(r)} horas</b> para volverlo a intentar.`}else{e=`Ha superado el límite de intentos fallidos, tiene que esperar <b>${Math.round(60*r)} minutos</b> para volverlo a intentar.`}Swal.fire({html:`<div style='text-align:left'>${e}</div>`,icon:"warning",confirmButtonText:"Aceptar",position:"top"})}else"FILL_THE_ANSWERS"==a[0]?Swal.fire({html:"<div style='text-align:left'>Seleccione las preguntas de seguridad.</div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}):"ERROR_CAPTCHA"==a[0]?Swal.fire({html:"<div style='text-align:left'>Se ha presentado un inconveniente con el <b>captcha</b>, por favor intente nuevamente.</div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}):"OK"!=a[0]?Swal.fire({html:"<div style='text-align:left'>\n              <b>Existen respuestas incocorrectas.</b>\n            </div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}):($("#check-mark").removeClass("hidden").addClass("animate__animated animate__fadeOutUp"),$("#progress").css("width","66%"),$("#verfy-answers").css("display","none"),$("#form").fadeIn().removeClass("hidden"))},finishLoad=()=>{$("#btn-check").removeClass("opacity-50 cursor-not-allowed"),$("#loader").addClass("hidden"),$("#lbl-next1").removeClass("hidden"),$("#check-mark").removeClass("hidden").addClass("animate__animated animate__fadeOutUp")},finishCheckAnswers=()=>{$("#btn-check2").removeClass("opacity-50 cursor-not-allowed"),$("#loader2").addClass("hidden"),$("#lbl-next2").removeClass("hidden")},showScreen=async e=>{if(1==e)$("#verfy-answers").addClass("hidden"),$("#form").addClass("hidden"),$("#verfy-operation-number").fadeIn();else if(2==e){$("#verfy-operation-number").addClass("hidden"),$("#form").addClass("hidden"),$("#verfy-answers").fadeIn();let e=JSON.parse(await getCurrentAnswers());if("NO_ANSWERS"==e[0])return void location.reload();$("#progress").css("width","33%"),$("#progress-loader").removeClass("hidden"),enableAnswers(e.answers)}else 3==e&&($("#verfy-operation-number").addClass("hidden"),$("#verfy-answers").addClass("hidden"),$("#progress").css("width","66%"),$("#progress-loader").removeClass("hidden"),$("#form").fadeIn());$("#vacucheckContainer").removeClass("hidden")},loadData=async()=>{let e=JSON.parse(await getPersonData()),a=e.RUC,r=e.PERSONTYPE,n=e.PROVINCE,t=e.BUSINESSNAME;a&&("Ninguna de las anteriores"==a?(a="",$("#ruc").val(a).empty().removeClass("cursor-not-allowed").prop("disabled",!1)):$("#ruc").val(a).addClass("cursor-not-allowed").prop("disabled",!0)),r&&("Ninguna de las anteriores"==r?(r="",$("#personType").val(a).removeClass("cursor-not-allowed").prop("disabled",!1)):$("#personType").val(r).addClass("cursor-not-allowed").prop("disabled",!0)),$("#personType option:selected").val()||$("#personType").removeClass("cursor-not-allowed").prop("disabled",!1),t&&("Ninguna de las anteriores"==t?(t="",$("#bussinessName").val(t).removeClass("cursor-not-allowed").prop("disabled",!1)):$("#bussinessName").val(t).addClass("cursor-not-allowed").prop("disabled",!0)),n&&("Ninguna de las anteriores"==n?(n="",$("#province").val(n).removeClass("cursor-not-allowed").prop("disabled",!1)):$("#province").val(n).addClass("cursor-not-allowed").prop("disabled",!0)),$("#province option:selected").val()||$("#province").removeClass("cursor-not-allowed").prop("disabled",!1)},create=async()=>{$("#ruc").removeClass("animate__animated animate__shakeX placeholder-red-200 border-red-300"),$("#phone").removeClass("animate__animated animate__shakeX placeholder-red-200 border-red-300"),$("#personalId").removeClass("animate__animated animate__shakeX placeholder-red-200 border-red-300"),$("#email").removeClass("animate__animated animate__shakeX placeholder-red-200 border-red-300"),$("#bussinessName").removeClass("animate__animated animate__shakeX placeholder-red-200 border-red-300"),$("#province").removeClass("animate__animated animate__shakeX placeholder-red-200 border-red-300");let e=$("#ruc").val(),a=$("#phone").val(),r=$("#personal-id").val(),n=$("#email").val(),t=$("#personType").val(),o=$("#bussinessName").val(),s=$("#province").val(),i=$("#password").val(),d=$("#repeatPassword").val(),l=$("#address").val();return e?a?validateCedula(r).isValid&&r?validateEmail(n)?o?s?void(i==d?i.length<8?Swal.fire({html:"<div style='text-align:left'><b>La contraseña debe poseer un mínimo de 8 caracteres.</b></div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}):i.match(/[A-Z]/)?i.match(/\d/)?($("#loader-create").removeClass("hidden"),$("#lbl-create").addClass("hidden"),await grecaptcha.ready(async()=>{let d=$("#uuid").val();grecaptcha.execute("6LeiVcYaAAAAAJdD1cpDx2jP8PSGokBgnG9hKDob",{action:"saveData"}).then(function(c){$("#_token").val(c);i=i,$.ajax({url:"./saveForm.php",method:"POST",data:{_token:c,uuid:d,ruc:e,phone:a,personalId:r,email:n,personType:t,bussinessName:o,province:s,password:i,action:"saveData",address:l},success:function(e){"EXISTS"==e[0]?(Swal.fire("Error!","El usuario ya se encuentra registrado.","error"),setTimeout(function(){window.location.reload()},3e3)):"STORED"==e[0]?(Swal.fire("Usuario registrado!","Cuenta de usuario registrada, recuerde que su nombre de usuario es su número RUC","success"),$("#progress").css("width","100%"),setTimeout(function(){window.location.reload()},12e3)):Swal.fire("Error!","Ha ocurrido un error al momento de crear la cuenta de usuario, por favor verifique su información.","error")},complete:()=>{$("#loader-create").addClass("hidden"),$("#lbl-create").removeClass("hidden")},error:()=>{$("#loader-create").addClass("hidden"),$("#lbl-create").removeClass("hidden")}})})})):Swal.fire({html:"<div style='text-align:left'><b>La contraseña debe poseer mínimo un número.</b></div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}):Swal.fire({html:"<div style='text-align:left'><b>La contraseña debe poseer mínimo una letra en mayúscula.</b></div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}):Swal.fire({html:"<div style='text-align:left'><b>Las contraseñas no coinciden.</b></div>",icon:"error",confirmButtonText:"Aceptar",position:"top"})):(Swal.fire({html:"<div style='text-align:left'><b>Seleccione la provincia.</b></div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}),void $("#province").addClass("animate__animated animate__shakeX placeholder-red-200 border-red-300")):(Swal.fire({html:"<div style='text-align:left'><b>Ingrese la razón social.</b></div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}),void $("#bussinessName").addClass("animate__animated animate__shakeX placeholder-red-200 border-red-300")):(Swal.fire({html:"<div style='text-align:left'><b>Ingrese una dirección de correo electrónico valida.</b></div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}),void $("#email").addClass("animate__animated animate__shakeX placeholder-red-200 border-red-300")):(Swal.fire({html:"<div style='text-align:left'><b>El número de cédula del responsable posee un formato incorrecto.</b></div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}),void $("#personalId").addClass("animate__animated animate__shakeX placeholder-red-200 border-red-300")):($("#phone").addClass("border-red-300"),Swal.fire({html:"<div style='text-align:left'><b>Ingrese un teléfono</b></div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}),void $("#phone").addClass("animate__animated animate__shakeX placeholder-red-200 border-red-500")):($("#ruc").addClass("border-red-300"),Swal.fire({html:"<div style='text-align:left'><b>Ingrese el número RUC</b></div>",icon:"error",confirmButtonText:"Aceptar",position:"top"}),void $("#ruc").addClass("animate__animated animate__shakeX placeholder-red-200 border-red-500"))};